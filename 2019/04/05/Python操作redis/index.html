<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Python操作redis | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="首先记得安装redis模块 12345678# py3中sudo pip3 install redisor# py2中sudo easy_install redisor# 源码安装详见：https://github.com/WoLpH/redis-py">
<meta name="keywords" content="redis,缓存,面试">
<meta property="og:type" content="article">
<meta property="og:title" content="Python操作redis">
<meta property="og:url" content="http://yoursite.com/2019/04/05/Python操作redis/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="首先记得安装redis模块 12345678# py3中sudo pip3 install redisor# py2中sudo easy_install redisor# 源码安装详见：https://github.com/WoLpH/redis-py">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-string.png">
<meta property="og:image" content="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-Hash.png">
<meta property="og:image" content="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-list.png">
<meta property="og:image" content="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.png">
<meta property="og:updated_time" content="2019-09-21T04:28:21.223Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python操作redis">
<meta name="twitter:description" content="首先记得安装redis模块 12345678# py3中sudo pip3 install redisor# py2中sudo easy_install redisor# 源码安装详见：https://github.com/WoLpH/redis-py">
<meta name="twitter:image" content="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-string.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Python操作redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/05/Python操作redis/" class="article-date">
  <time datetime="2019-04-05T14:13:55.000Z" itemprop="datePublished">2019-04-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Python操作redis
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先记得安装redis模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># py3中</span></span><br><span class="line">sudo pip3 install redis</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line"><span class="comment"># py2中</span></span><br><span class="line">sudo easy_install redis</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line"><span class="comment"># 源码安装</span></span><br><span class="line">详见：https://github.com/WoLpH/redis-py</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h3 id="API的使用"><a href="#API的使用" class="headerlink" title="API的使用"></a><code>API的使用</code></h3><p>redis-py 的API的使用可以分类为：</p>
<ul>
<li>连接方式</li>
<li>连接池</li>
<li>操作<ul>
<li>String 操作</li>
<li>Hash 操作</li>
<li>List 操作</li>
<li>Set 操作</li>
<li>Sort Set 操作</li>
</ul>
</li>
<li>管道</li>
<li>发布订阅</li>
</ul>
<h3 id="redis常见的面试题"><a href="#redis常见的面试题" class="headerlink" title="redis常见的面试题"></a><code>redis常见的面试题</code></h3><details>
  <summary>redis常见的面试题</summary>
  <pre><code>
1. 使用Redis有哪些好处？
(1) 速度快，因为数据存在内存中，类似于HashMap，HashMap的优势就是查找和操作的时间复杂度都是O(1)
(2) 支持丰富数据类型，支持string，list，set，sorted set，hash
(3) 支持事务，操作都是原子性，所谓的原子性就是对数据的更改要么全部执行，要么全部不执行
(4) 丰富的特性：可用于缓存，消息，按key设置过期时间，过期后将会自动删除

<ol start="2">
<li><p>redis相比memcached有哪些优势？<br>(1) memcached所有的值均是简单的字符串，redis作为其替代者，支持更为丰富的数据类型<br>(2) redis的速度比memcached快很多<br>(3) redis可以持久化其数据</p>
</li>
<li><p>redis常见性能问题和解决方案：<br>(1) Master最好不要做任何持久化工作，如RDB内存快照和AOF日志文件<br>(2) 如果数据比较重要，某个Slave开启AOF备份数据，策略设置为每秒同步一次<br>(3) 为了主从复制的速度和连接的稳定性，Master和Slave最好在同一个局域网内<br>(4) 尽量避免在压力很大的主库上增加从库<br>(5) 主从复制不要用图状结构，用单向链表结构更为稳定，即：Master &lt;- Slave1 &lt;- Slave2 &lt;- Slave3…<br>这样的结构方便解决单点故障问题，实现Slave对Master的替换。如果Master挂了，可以立刻启用Slave1做Master，其他不变。</p>
</li>
<li><p>MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据<br>相关知识：redis 内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。redis 提供 6种数据淘汰策略：<br>voltile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰<br>volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰<br>volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰<br>allkeys-lru：从数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰<br>allkeys-random：从数据集（server.db[i].dict）中任意选择数据淘汰<br>no-enviction（驱逐）：禁止驱逐数据</p>
</li>
<li><p>Memcache与Redis的区别都有哪些？<br>1)、存储方式<br>Memecache把数据全部存在内存之中，断电后会挂掉，数据不能超过内存大小。<br>Redis有部份存在硬盘上，这样能保证数据的持久性。<br>2)、数据支持类型<br>Memcache对数据类型支持相对简单。<br>Redis有复杂的数据类型。<br>3），value大小<br>redis最大可以达到1GB，而memcache只有1MB</p>
</li>
<li><p>Redis 常见的性能问题都有哪些？如何解决？<br>1).Master写内存快照，save命令调度rdbSave函数，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务，所以Master最好不要写内存快照。</p>
</li>
</ol>
<p>2).Master AOF持久化，如果不重写AOF文件，这个持久化方式对性能的影响是最小的，但是AOF文件会不断增大，AOF文件过大会影响Master重启的恢复速度。Master最好不要做任何持久化工作，包括内存快照和AOF日志文件，特别是不要启用内存快照做持久化,如果数据比较关键，某个Slave开启AOF备份数据，策略为每秒同步一次。</p>
<p>3).Master调用BGREWRITEAOF重写AOF文件，AOF在重写的时候会占大量的CPU和内存资源，导致服务load过高，出现短暂服务暂停现象。</p>
<p>4). Redis主从复制的性能问题，为了主从复制的速度和连接的稳定性，Slave和Master最好在同一个局域网内</p>
<p>7, redis 最适合的场景</p>
<p>Redis最适合所有数据in-momory的场景，虽然Redis也提供持久化功能，但实际更多的是一个disk-backed的功能，跟传统意义上的持久化有比较大的差别，那么可能大家就会有疑问，似乎Redis更像一个加强版的Memcached，那么何时使用Memcached,何时使用Redis呢?</p>
<p>***如果简单地比较Redis与Memcached的区别，大多数都会得到以下观点：<br>、Redis不仅仅支持简单的k/v类型的数据，同时还提供list，set，zset，hash等数据结构的存储。<br>、Redis支持数据的备份，即master-slave模式的数据备份。<br>、Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</p>
<p>（1）、会话缓存（Session Cache）<br>最常用的一种使用Redis的情景是会话缓存（session cache）。用Redis缓存会话比其他存储（如Memcached）的优势在于：Redis提供持久化。当维护一个不是严格要求一致性的缓存时，如果用户的购物车信息全部丢失，大部分人都会不高兴的，现在，他们还会这样吗？<br>幸运的是，随着 Redis 这些年的改进，很容易找到怎么恰当的使用Redis来缓存会话的文档。甚至广为人知的商业平台Magento也提供Redis的插件。</p>
<p>（2）、全页缓存（FPC）<br>除基本的会话token之外，Redis还提供很简便的FPC平台。回到一致性问题，即使重启了Redis实例，因为有磁盘的持久化，用户也不会看到页面加载速度的下降，这是一个极大改进，类似PHP本地FPC。<br>再次以Magento为例，Magento提供一个插件来使用Redis作为全页缓存后端。<br>此外，对WordPress的用户来说，Pantheon有一个非常好的插件  wp-redis，这个插件能帮助你以最快速度加载你曾浏览过的页面。</p>
<p>（3）、队列<br>Reids在内存存储引擎领域的一大优点是提供 list 和 set 操作，这使得Redis能作为一个很好的消息队列平台来使用。Redis作为队列使用的操作，就类似于本地程序语言（如Python）对 list 的 push/pop 操作。</p>
<p>如果你快速的在Google中搜索“Redis queues”，你马上就能找到大量的开源项目，这些项目的目的就是利用Redis创建非常好的后端工具，以满足各种队列需求。例如，Celery有一个后台就是使用Redis作为broker，你可以从这里去查看。</p>
<p>（4），排行榜/计数器<br>Redis在内存中对数字进行递增或递减的操作实现的非常好。集合（Set）和有序集合（Sorted Set）也使得我们在执行这些操作的时候变的非常简单，Redis只是正好提供了这两种数据结构。所以，我们要从排序集合中获取到排名最靠前的10个用户–我们称之为“user_scores”，我们只需要像下面一样执行即可：<br>当然，这是假定你是根据你用户的分数做递增的排序。如果你想返回用户及用户的分数，你需要这样执行：</p>
<p>ZRANGE user_scores 0 10 WITHSCORES</p>
<p>Agora Games就是一个很好的例子，用Ruby实现的，它的排行榜就是使用Redis来存储数据的，你可以在这里看到。</p>
<p>（5）、发布/订阅<br>最后（但肯定不是最不重要的）是Redis的发布/订阅功能。发布/订阅的使用场景确实非常多。我已看见人们在社交网络连接中使用，还可作为基于发布/订阅的脚本触发器，甚至用Redis的发布/订阅功能来建立聊天系统！（不，这是真的，你可以去核实）。<br>Redis提供的所有特性中，我感觉这个是喜欢的人最少的一个，虽然它为用户提供如果此多功能。<br>  </p></code></pre><p></p>
</details>

<h3 id="Python操作redis"><a href="#Python操作redis" class="headerlink" title="Python操作redis"></a><code>Python操作redis</code></h3><h4 id="1-操作模式"><a href="#1-操作模式" class="headerlink" title="1.操作模式"></a><code>1.操作模式</code></h4><p>redis-py提供两个类Redis和StrictRedis用于实现Redis的命令，StrictRedis用于实现大部分官方的命令，并使用官方的语法和命令，Redis是StrictRedis的子类，用于向后兼容旧版本的redis-py。</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">r = redis.Redis(host=<span class="string">'127.0.0.1'</span>,port=<span class="number">6379</span>,password=<span class="string">'123'</span>)</span><br><span class="line">r.set(<span class="string">'name1'</span>,<span class="string">'wanghw'</span>)</span><br><span class="line">print(r.get(<span class="string">'name1'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6s后失效</span></span><br><span class="line">r.set(<span class="string">'name2'</span>,<span class="string">'www'</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-连接池"><a href="#2-连接池" class="headerlink" title="2.连接池"></a><code>2.连接池</code></h4><p>redis-py使用connection pool来管理对一个redis server的所有连接，避免每次建立、释放连接的开销。默认，每个Redis实例都会维护一个自己的连接池。可以直接建立一个连接池，然后作为参数Redis，这样就可以实现多个Redis实例共享一个连接池。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"> </span><br><span class="line">pool = redis.ConnectionPool(host=<span class="string">'10.211.55.4'</span>, port=<span class="number">6379</span>)</span><br><span class="line"> </span><br><span class="line">r = redis.Redis(connection_pool=pool)</span><br><span class="line">r.set(<span class="string">'foo'</span>, <span class="string">'Bar'</span>)</span><br><span class="line"><span class="keyword">print</span> r.get(<span class="string">'foo'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-Python对redis基本数据类型的操作"><a href="#3-Python对redis基本数据类型的操作" class="headerlink" title="3.Python对redis基本数据类型的操作"></a><code>3.Python对redis基本数据类型的操作</code></h4><h5 id="String操作"><a href="#String操作" class="headerlink" title="String操作"></a><code>String操作</code></h5><p><strong>redis中的String在在内存中按照一个name对应一个value来存储。如图：</strong><br><img src="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-string.png" alt="string"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String实现简单的k-v简直对存储，可以用作计数器等等。</span><br></pre></td></tr></table></figure>

<p><strong>1.set(name, value, ex=None, px=None, nx=False, xx=False)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在Redis中设置值，默认，不存在则创建，存在则修改</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># ex，过期时间（秒）</span></span><br><span class="line">    <span class="comment"># px，过期时间（毫秒）</span></span><br><span class="line">    <span class="comment"># nx，如果设置为True，则只有name不存在时，当前set操作才执行</span></span><br><span class="line">    <span class="comment"># xx，如果设置为True，则只有name存在时，岗前set操作才执行</span></span><br></pre></td></tr></table></figure>

<p><strong>2.setnx(name, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置值，只有name不存在时，执行设置操作（添加）</span></span><br></pre></td></tr></table></figure>

<p><strong>3.setex(name, value, time)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置值</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># time，过期时间（数字秒 或 timedelta对象）</span></span><br></pre></td></tr></table></figure>

<p><strong>4.psetex(name, time_ms, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置值</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># time_ms，过期时间（数字毫秒 或 timedelta对象）</span></span><br></pre></td></tr></table></figure>

<p><strong>5.批量设置值</strong>——mset(<em>args, *</em>kwargs)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 批量设置值</span></span><br><span class="line">如：</span><br><span class="line">    <span class="comment"># mset(k1='v1', k2='v2')</span></span><br><span class="line">    或</span><br><span class="line">    <span class="comment"># mget(&#123;'k1': 'v1', 'k2': 'v2'&#125;)</span></span><br></pre></td></tr></table></figure>

<p><strong>6.get(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取值</span></span><br></pre></td></tr></table></figure>

<p><strong>7.mget(keys, *args)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 批量获取</span></span><br><span class="line">如：</span><br><span class="line">   <span class="comment"># mget('ylr', 'wupeiqi')</span></span><br><span class="line">    或</span><br><span class="line">   <span class="comment"># r.mget(['ylr', 'wupeiqi'])</span></span><br></pre></td></tr></table></figure>

<p><strong>8.getset(name, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置新值并获取原来的值</span></span><br></pre></td></tr></table></figure>

<p><strong>9.getrange(key, start, end)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取子序列（根据字节获取，非字符）</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，Redis 的 name</span></span><br><span class="line">    <span class="comment"># start，起始位置（字节）</span></span><br><span class="line">    <span class="comment"># end，结束位置（字节）</span></span><br><span class="line"><span class="comment"># 如： "孙悟空" ，0-3表示 "孙"</span></span><br></pre></td></tr></table></figure>

<p><strong>10.setrange(name, offset, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改字符串内容，从指定字符串索引开始向后替换（新值太长时，则向后添加）</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># offset，字符串的索引，字节（一个汉字三个字节）</span></span><br><span class="line">    <span class="comment"># value，要设置的值</span></span><br></pre></td></tr></table></figure>

<p><strong>11.setbit(name, offset, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对name对应值的二进制表示的位进行操作</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># offset，位的索引（将值变换成二进制后再进行索引）</span></span><br><span class="line">    <span class="comment"># value，值只能是 1 或 0</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 注：如果在Redis中有一个对应： n1 = "foo"，</span></span><br><span class="line">        那么字符串foo的二进制表示为：<span class="number">01100110</span> <span class="number">01101111</span> <span class="number">01101111</span></span><br><span class="line">    所以，如果执行 setbit(<span class="string">'n1'</span>, <span class="number">7</span>, <span class="number">1</span>)，则就会将第<span class="number">7</span>位设置为<span class="number">1</span>，</span><br><span class="line">        那么最终二进制则变成 <span class="number">01100111</span> <span class="number">01101111</span> <span class="number">01101111</span>，即：<span class="string">"goo"</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 扩展，转换二进制表示：</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line">    s = <span class="string">'王宏伟'</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        num  = ord(i)</span><br><span class="line">        print(i)</span><br><span class="line">        print(num)</span><br><span class="line">        print(bin(num))</span><br><span class="line">        print(bin(num).replace(<span class="string">'b'</span>,<span class="string">''</span>))</span><br><span class="line"> </span><br><span class="line">    特别的，如果source是汉字 <span class="string">"王宏伟"</span>怎么办？</span><br><span class="line">    答：对于utf<span class="number">-8</span>，每一个汉字占 <span class="number">3</span> 个字节，那么 <span class="string">"王宏伟"</span> 则有 <span class="number">9</span>个字节</span><br><span class="line">       对于汉字，<span class="keyword">for</span>循环时候会按照 字节 迭代，那么在迭代时，将每一个字节转换 十进制数，然后再将十进制数转换成二进制</span><br><span class="line">        <span class="number">11100110</span> <span class="number">10101101</span> <span class="number">10100110</span> <span class="number">11100110</span> <span class="number">10110010</span> <span class="number">10011011</span> <span class="number">11101001</span> <span class="number">10111101</span> <span class="number">10010000</span></span><br><span class="line">        -------------------------- ----------------------------- -----------------------------</span><br><span class="line">                    王                         宏                           伟</span><br></pre></td></tr></table></figure>

<p><strong>12.getbit(name, offset)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的值的二进制表示中的某位的值 （0或1）</span></span><br></pre></td></tr></table></figure>

<p><strong>13.bitcount(key, start=None, end=None)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的值的二进制表示中 1 的个数</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># key，Redis的name</span></span><br><span class="line">    <span class="comment"># start，位起始位置</span></span><br><span class="line">    <span class="comment"># end，位结束位置</span></span><br></pre></td></tr></table></figure>

<p><strong>14.bitop(operation, dest, *keys)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取多个值，并将值做位运算，将最后的结果保存至新的name对应的值</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># operation,AND（并） 、 OR（或） 、 NOT（非） 、 XOR（异或）</span></span><br><span class="line">    <span class="comment"># dest, 新的Redis的name</span></span><br><span class="line">    <span class="comment"># *keys,要查找的Redis的name</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如：</span></span><br><span class="line">    bitop(<span class="string">"AND"</span>, <span class="string">'new_name'</span>, <span class="string">'n1'</span>, <span class="string">'n2'</span>, <span class="string">'n3'</span>)</span><br><span class="line">    <span class="comment"># 获取Redis中n1,n2,n3对应的值，然后讲所有的值做位运算（求并集），然后将结果保存 new_name 对应的值中</span></span><br></pre></td></tr></table></figure>

<p><strong>15.strlen(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回name对应值的字节长度（一个汉字3个字节）</span></span><br></pre></td></tr></table></figure>

<p><strong>16.incr(self, name, amount=1)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name,Redis的name</span></span><br><span class="line">    <span class="comment"># amount,自增数（必须是整数）</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 注：同incrby</span></span><br></pre></td></tr></table></figure>

<p><strong>17.incrbyfloat(self, name, amount=1.0)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name,Redis的name</span></span><br><span class="line">    <span class="comment"># amount,自增数（浮点型）</span></span><br></pre></td></tr></table></figure>

<p><strong>18.decr(self, name, amount=1)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自减 name对应的值，当name不存在时，则创建name＝amount，否则，则自减。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name,Redis的name</span></span><br><span class="line">    <span class="comment"># amount,自减数（整数）</span></span><br></pre></td></tr></table></figure>

<p><strong>19.append(key, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在redis name对应的值后面追加内容</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    key, redis的name</span><br><span class="line">    value, 要追加的字符串</span><br></pre></td></tr></table></figure>

<h5 id="Hash操作"><a href="#Hash操作" class="headerlink" title="Hash操作"></a><code>Hash操作</code></h5><p>redis中Hash在内存中的存储格式如下图：<br><img src="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-Hash.png" alt="Hash"><br><strong>1.hset(name, key, value)</strong><br>——用来存储彼此相关信息的键值对。例如：<code>hset(name,id,username)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># name对应的hash中设置一个键值对（不存在，则创建；否则，修改）</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># key，name对应的hash中的key</span></span><br><span class="line">    <span class="comment"># value，name对应的hash中的value</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 注：</span></span><br><span class="line">    <span class="comment"># hsetnx(name, key, value),当name对应的hash中不存在当前key时则创建（相当于添加）</span></span><br></pre></td></tr></table></figure>

<p><strong>2.hmset(name, mapping)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的hash中批量设置键值对</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># mapping，字典，如：&#123;'k1':'v1', 'k2': 'v2'&#125;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如：</span></span><br><span class="line">    <span class="comment"># r.hmset('xx', &#123;'k1':'v1', 'k2': 'v2'&#125;)</span></span><br></pre></td></tr></table></figure>

<p><strong>3.hget(name,key)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的hash中获取根据key获取value</span></span><br></pre></td></tr></table></figure>

<p><strong>4.hmget(name, keys, *args)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的hash中获取多个key的值</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，reids对应的name</span></span><br><span class="line">    <span class="comment"># keys，要获取key集合，如：['k1', 'k2', 'k3']</span></span><br><span class="line">    <span class="comment"># *args，要获取的key，如：k1,k2,k3</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如：</span></span><br><span class="line">    <span class="comment"># r.mget('xx', ['k1', 'k2'])</span></span><br><span class="line">    <span class="comment"># 或</span></span><br><span class="line">    <span class="comment"># print r.hmget('xx', 'k1', 'k2')</span></span><br></pre></td></tr></table></figure>

<p><strong>5.hgetall(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应hash的所有键值</span></span><br></pre></td></tr></table></figure>

<p><strong>6.hlen(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的hash中键值对的个数</span></span><br></pre></td></tr></table></figure>

<p><strong>7.hkeys(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的hash中所有的key的值</span></span><br></pre></td></tr></table></figure>

<p><strong>8.hvals(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的hash中所有的value的值</span></span><br></pre></td></tr></table></figure>

<p><strong>9.hexists(name, key)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查name对应的hash是否存在当前传入的key</span></span><br></pre></td></tr></table></figure>

<p><strong>10.hdel(name,*keys)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将name对应的hash中指定key的键值对删除</span></span><br></pre></td></tr></table></figure>

<p><strong>11.hincrby(name, key, amount=1)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis中的name</span></span><br><span class="line">    <span class="comment"># key， hash对应的key</span></span><br><span class="line">    <span class="comment"># amount，自增数（整数）</span></span><br></pre></td></tr></table></figure>

<p><strong>12.hincrbyfloat(name, key, amount=1.0)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis中的name</span></span><br><span class="line">    <span class="comment"># key， hash对应的key</span></span><br><span class="line">    <span class="comment"># amount，自增数（浮点数）</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span></span><br></pre></td></tr></table></figure>

<p><strong>13.hscan(name, cursor=0, match=None, count=None)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增量式迭代获取，对于数据大的数据非常有用，hscan可以实现分片的获取数据，并非一次性将数据全部获取完，从而放置内存被撑爆</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># cursor，游标（基于游标分批取获取数据）</span></span><br><span class="line">    <span class="comment"># match，匹配指定key，默认None 表示所有的key</span></span><br><span class="line">    <span class="comment"># count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如：</span></span><br><span class="line">    <span class="comment"># 第一次：cursor1, data1 = r.hscan('xx', cursor=0, match=None, count=None)</span></span><br><span class="line">    <span class="comment"># 第二次：cursor2, data1 = r.hscan('xx', cursor=cursor1, match=None, count=None)</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="comment"># 直到返回值cursor的值为0时，表示数据已经通过分片获取完毕</span></span><br></pre></td></tr></table></figure>

<p><strong>14.hscan_iter(name, match=None, count=None)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用yield封装hscan创建生成器，实现分批去redis中获取数据</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># match，匹配指定key，默认None 表示所有的key</span></span><br><span class="line">    <span class="comment"># count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如：</span></span><br><span class="line">    <span class="comment"># for item in r.hscan_iter('xx'):</span></span><br><span class="line">    <span class="comment">#     print item</span></span><br></pre></td></tr></table></figure>

<h5 id="List操作"><a href="#List操作" class="headerlink" title="List操作"></a><code>List操作</code></h5><p>List即链表，可以实现<code>双向链表</code>，比如用户的关注、粉丝列表等等。<br>redis中的List在在内存中按照一个name对应一个List来存储。如图：<br><img src="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-list.png" alt="List"><br><strong>1.lpush(name,values)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的list中添加元素，每个新的元素都添加到列表的最左边</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如：</span></span><br><span class="line">    <span class="comment"># r.lpush('oo', 11,22,33)</span></span><br><span class="line">    <span class="comment"># 保存顺序为: 33,22,11</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 扩展：</span></span><br><span class="line">    <span class="comment"># rpush(name, values) 表示从右向左操作</span></span><br></pre></td></tr></table></figure>

<p><strong>2.lpushx(name,value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的list中添加元素，只有name已经存在时，值添加到列表的最左边</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 更多：</span></span><br><span class="line">    <span class="comment"># rpushx(name, value) 表示从右向左操作</span></span><br></pre></td></tr></table></figure>

<p><strong>3.llen(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># name对应的list元素的个数</span></span><br></pre></td></tr></table></figure>

<p><strong>4.linsert(name, where, refvalue, value))</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的列表的某一个值前或后插入一个新值</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># where，BEFORE或AFTER</span></span><br><span class="line">    <span class="comment"># refvalue，标杆值，即：在它前后插入数据</span></span><br><span class="line">    <span class="comment"># value，要插入的数据</span></span><br></pre></td></tr></table></figure>

<p><strong>5.lset(name, index, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对name对应的list中的某一个索引位置重新赋值</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># index，list的索引位置</span></span><br><span class="line">    <span class="comment"># value，要设置的值</span></span><br></pre></td></tr></table></figure>

<p><strong>6.lrem(name, value, num)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的list中删除指定的值</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># value，要删除的值</span></span><br><span class="line">    <span class="comment"># num，num=0，删除列表中所有的指定值；</span></span><br><span class="line">           <span class="comment"># num=2,从前到后，删除2个；</span></span><br><span class="line">           <span class="comment"># num=-2,从后向前，删除2个</span></span><br></pre></td></tr></table></figure>

<p><strong>7.lpop(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的列表的左侧获取第一个元素并在列表中移除，返回值则是第一个元素</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 更多：</span></span><br><span class="line">    <span class="comment"># rpop(name) 表示从右向左操作</span></span><br></pre></td></tr></table></figure>

<p><strong>8.lindex(name, index)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的列表中根据索引获取列表元素</span></span><br></pre></td></tr></table></figure>

<p><strong>9.lrange(name, start, end)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的列表分片获取数据</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># start，索引的起始位置</span></span><br><span class="line">    <span class="comment"># end，索引结束位置</span></span><br></pre></td></tr></table></figure>

<p><strong>10.ltrim(name, start, end)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的列表中移除没有在start-end索引之间的值</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># start，索引的起始位置</span></span><br><span class="line">    <span class="comment"># end，索引结束位置</span></span><br></pre></td></tr></table></figure>

<p><strong>11.rpoplpush(src, dst)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从一个列表取出最右边的元素，同时将其添加至另一个列表的最左边</span></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># src，要取数据的列表的name</span></span><br><span class="line">    <span class="comment"># dst，要添加数据的列表的name</span></span><br></pre></td></tr></table></figure>

<p><strong>12.blpop(keys, timeout)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将多个列表排列，按照从左到右去pop对应列表的元素</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># keys，redis的name的集合</span></span><br><span class="line">    <span class="comment"># timeout，超时时间，当元素所有列表的元素获取完之后，阻塞等待列表内有数据的时间（秒）, 0 表示永远阻塞</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 更多：</span></span><br><span class="line">    <span class="comment"># r.brpop(keys, timeout)，从右向左获取数据</span></span><br></pre></td></tr></table></figure>

<p><strong>13.brpoplpush(src, dst, timeout=0)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从一个列表的右侧移除一个元素并将其添加到另一个列表的左侧</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># src，取出并要移除元素的列表对应的name</span></span><br><span class="line">    <span class="comment"># dst，要插入元素的列表对应的name</span></span><br><span class="line">    <span class="comment"># timeout，当src对应的列表中没有数据时，阻塞等待其有数据的超时时间（秒），0 表示永远阻塞</span></span><br></pre></td></tr></table></figure>

<p><strong>14.自定义增量迭代</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由于redis类库中没有提供对列表元素的增量迭代，如果想要循环name对应的列表的所有元素，那么就需要：</span></span><br><span class="line">    <span class="comment"># 1、获取name对应的所有列表</span></span><br><span class="line">    <span class="comment"># 2、循环列表</span></span><br><span class="line"><span class="comment"># 但是，如果列表非常大，那么就有可能在第一步时就将程序的内容撑爆，所有有必要自定义一个增量迭代的功能：</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_iter</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    自定义redis列表增量迭代</span></span><br><span class="line"><span class="string">    :param name: redis中的name，即：迭代name对应的列表</span></span><br><span class="line"><span class="string">    :return: yield 返回 列表元素</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    list_count = r.llen(name)</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> xrange(list_count):</span><br><span class="line">        <span class="keyword">yield</span> r.lindex(name, index)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> list_iter(<span class="string">'pp'</span>):</span><br><span class="line">    <span class="keyword">print</span> item</span><br></pre></td></tr></table></figure>

<h5 id="Set操作"><a href="#Set操作" class="headerlink" title="Set操作"></a><code>Set操作</code></h5><p>Set集合就是不允许重复的列表。<code>它用来存储不重复的元素，比如用户的关注者等等</code>。<br><strong>1.sadd(name,values)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># name对应的集合中添加元素</span></span><br></pre></td></tr></table></figure>

<p><strong>2.scard(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的集合中元素个数</span></span><br></pre></td></tr></table></figure>

<p><strong>3.sdiff(keys, *args)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在第一个name对应的集合中且不在其他name对应的集合的元素集合</span></span><br></pre></td></tr></table></figure>

<p><strong>4.sdiffstore(dest, keys, *args)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取第一个name对应的集合中且不在其他name对应的集合，再将其新加入到dest对应的集合中</span></span><br></pre></td></tr></table></figure>

<p><strong>5.sinter(keys, *args)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取多一个name对应集合的并集</span></span><br></pre></td></tr></table></figure>

<p><strong>6.sinterstore(dest, keys, *args)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取多一个name对应集合的并集，再讲其加入到dest对应的集合中</span></span><br></pre></td></tr></table></figure>

<p><strong>7.sismember(name, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查value是否是name对应的集合的成员</span></span><br></pre></td></tr></table></figure>

<p><strong>8.smembers(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的集合的所有成员</span></span><br></pre></td></tr></table></figure>

<p><strong>9.smove(src, dst, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将某个成员从一个集合中移动到另外一个集合</span></span><br></pre></td></tr></table></figure>

<p><strong>10.spop(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从集合的右侧（尾部）移除一个成员，并将其返回</span></span><br></pre></td></tr></table></figure>

<p><strong>11.srandmember(name, numbers)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从name对应的集合中随机获取 numbers 个元素</span></span><br></pre></td></tr></table></figure>

<p><strong>12.srem(name, values)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的集合中删除某些值</span></span><br></pre></td></tr></table></figure>

<p><strong>13.sunion(keys, *args)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取多一个name对应的集合的并集</span></span><br></pre></td></tr></table></figure>

<p><strong>14.sunionstore(dest,keys, *args)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取多一个name对应的集合的并集，并将结果保存到dest对应的集合中</span></span><br></pre></td></tr></table></figure>

<p><strong>15.</strong><br><strong>sscan(name, cursor=0, match=None, count=None)</strong><br><strong>sscan_iter(name, match=None, count=None)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同字符串的操作，用于增量迭代分批获取元素，避免内存消耗太大</span></span><br></pre></td></tr></table></figure>

<h5 id="有序集合"><a href="#有序集合" class="headerlink" title="有序集合"></a><code>有序集合</code></h5><p>在集合的基础上，为每元素排序；元素的排序需要根据另外一个值来进行比较，所以，对于有序集合，每一个元素有两个值，即：值和分数，分数专门用来做排序。<code>可以实现实时信息排行榜等。</code><br><strong>1.在name对应的有序集合中添加元素：</strong>zadd(name, <em>args, *</em>kwargs)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在name对应的有序集合中添加元素</span></span><br><span class="line"><span class="comment"># 如：</span></span><br><span class="line">     <span class="comment"># zadd('zz', 'n1', 1, 'n2', 2)</span></span><br><span class="line">     <span class="comment"># 或</span></span><br><span class="line">     <span class="comment"># zadd('zz', n1=11, n2=22)</span></span><br></pre></td></tr></table></figure>

<p><strong>2.zcard(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的有序集合元素的数量</span></span><br></pre></td></tr></table></figure>

<p><strong>3.zcount(name, min, max)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应的有序集合中分数 在 [min,max] 之间的个数</span></span><br></pre></td></tr></table></figure>

<p><strong>4.zincrby(name, value, amount)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自增name对应的有序集合的 name 对应的分数</span></span><br></pre></td></tr></table></figure>

<p><strong>5.zrange( name, start, end, desc=False, withscores=False, score_cast_func=float)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照索引范围获取name对应的有序集合的元素</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># start，有序集合索引起始位置（非分数）</span></span><br><span class="line">    <span class="comment"># end，有序集合索引结束位置（非分数）</span></span><br><span class="line">    <span class="comment"># desc，排序规则，默认按照分数从小到大排序</span></span><br><span class="line">    <span class="comment"># withscores，是否获取元素的分数，默认只获取元素的值</span></span><br><span class="line">    <span class="comment"># score_cast_func，对分数进行数据转换的函数</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 更多：</span></span><br><span class="line">    <span class="comment"># 从大到小排序</span></span><br><span class="line">    <span class="comment"># zrevrange(name, start, end, withscores=False, score_cast_func=float)</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 按照分数范围获取name对应的有序集合的元素</span></span><br><span class="line">    <span class="comment"># zrangebyscore(name, min, max, start=None, num=None, withscores=False, score_cast_func=float)</span></span><br><span class="line">    <span class="comment"># 从大到小排序</span></span><br><span class="line">    <span class="comment"># zrevrangebyscore(name, max, min, start=None, num=None, withscores=False, score_cast_func=float)</span></span><br></pre></td></tr></table></figure>

<p><strong>6.zrank(name, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取某个值在 name对应的有序集合中的排行（从 0 开始）</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 更多：</span></span><br><span class="line">    <span class="comment"># zrevrank(name, value)，从大到小排序</span></span><br></pre></td></tr></table></figure>

<p><strong>7.zrangebylex(name, min, max, start=None, num=None)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当有序集合的所有成员都具有相同的分值时，有序集合的元素会根据成员的 值 （lexicographical ordering）来进行排序，而这个命令则可以返回给定的有序集合键 key 中， 元素的值介于 min 和 max 之间的成员</span></span><br><span class="line"><span class="comment"># 对集合中的每个成员进行逐个字节的对比（byte-by-byte compare）， 并按照从低到高的顺序， 返回排序后的集合成员。 如果两个字符串有一部分内容是相同的话， 那么命令会认为较长的字符串比较短的字符串要大</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">    <span class="comment"># name，redis的name</span></span><br><span class="line">    <span class="comment"># min，左区间（值）。 + 表示正无限； - 表示负无限； ( 表示开区间； [ 则表示闭区间</span></span><br><span class="line">    <span class="comment"># min，右区间（值）</span></span><br><span class="line">    <span class="comment"># start，对结果进行分片处理，索引位置</span></span><br><span class="line">    <span class="comment"># num，对结果进行分片处理，索引后面的num个元素</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如：</span></span><br><span class="line">    <span class="comment"># ZADD myzset 0 aa 0 ba 0 ca 0 da 0 ea 0 fa 0 ga</span></span><br><span class="line">    <span class="comment"># r.zrangebylex('myzset', "-", "[ca") 结果为：['aa', 'ba', 'ca']</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 更多：</span></span><br><span class="line">    <span class="comment"># 从大到小排序</span></span><br><span class="line">    <span class="comment"># zrevrangebylex(name, max, min, start=None, num=None)</span></span><br></pre></td></tr></table></figure>

<p><strong>8.zrem(name, values)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除name对应的有序集合中值是values的成员</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如：zrem('zz', ['s1', 's2'])</span></span><br></pre></td></tr></table></figure>

<p><strong>9.zremrangebyrank(name, min, max)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据排行范围删除</span></span><br></pre></td></tr></table></figure>

<p><strong>10.zremrangebyscore(name, min, max)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据分数范围删除</span></span><br></pre></td></tr></table></figure>

<p><strong>11.zremrangebylex(name, min, max)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据值返回删除</span></span><br></pre></td></tr></table></figure>

<p><strong>12.zscore(name, value)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应有序集合中 value 对应的分数</span></span><br></pre></td></tr></table></figure>

<p><strong>13.zinterstore(dest, keys, aggregate=None)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取两个有序集合的交集，如果遇到相同值不同分数，则按照aggregate进行操作</span></span><br><span class="line"><span class="comment"># aggregate的值为:  SUM  MIN  MAX</span></span><br></pre></td></tr></table></figure>

<p><strong>14.zunionstore(dest, keys, aggregate=None)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取两个有序集合的并集，如果遇到相同值不同分数，则按照aggregate进行操作</span></span><br><span class="line"><span class="comment"># aggregate的值为:  SUM  MIN  MAX</span></span><br></pre></td></tr></table></figure>

<p><strong>15.</strong><br><strong>zscan(name, cursor=0, match=None, count=None, score_cast_func=float)</strong><br><strong>zscan_iter(name, match=None, count=None,score_cast_func=float)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同字符串相似，相较于字符串新增score_cast_func，用来对分数进行操作</span></span><br></pre></td></tr></table></figure>

<h5 id="其他常用操作"><a href="#其他常用操作" class="headerlink" title="其他常用操作"></a><code>其他常用操作</code></h5><p><strong>1.delete(*names)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据删除redis中的任意数据类型</span></span><br></pre></td></tr></table></figure>

<p><strong>2.exists(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检测redis的name是否存在</span></span><br></pre></td></tr></table></figure>

<p><strong>3.keys(pattern=’*’)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据模型获取redis的name</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 更多：</span></span><br><span class="line">    <span class="comment"># KEYS * 匹配数据库中所有 key 。</span></span><br><span class="line">    <span class="comment"># KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。</span></span><br><span class="line">    <span class="comment"># KEYS h*llo 匹配 hllo 和 heeeeello 等。</span></span><br><span class="line">    <span class="comment"># KEYS h[ae]llo 匹配 hello 和 hallo ，但不匹配 hillo</span></span><br></pre></td></tr></table></figure>

<p><strong>4.expire(name ,time)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为某个redis的某个name设置超时时间</span></span><br></pre></td></tr></table></figure>

<p><strong>5.rename(src, dst)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对redis的name重命名为</span></span><br></pre></td></tr></table></figure>

<p><strong>6.move(name, db))</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将redis的某个值移动到指定的db下</span></span><br></pre></td></tr></table></figure>

<p><strong>7.randomkey()</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 随机获取一个redis的name（不删除）</span></span><br></pre></td></tr></table></figure>

<p><strong>8.type(name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取name对应值的类型</span></span><br></pre></td></tr></table></figure>

<p><strong>9.</strong><br><strong>scan(cursor=0, match=None, count=None)</strong><br><strong>scan_iter(match=None, count=None)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同字符串操作，用于增量迭代获取key</span></span><br></pre></td></tr></table></figure>

<h3 id="redis中的事物——管道与计数器的实现"><a href="#redis中的事物——管道与计数器的实现" class="headerlink" title="redis中的事物——管道与计数器的实现"></a><code>redis中的事物——管道与计数器的实现</code></h3><p><strong>1.管道</strong><br>redis-py默认在执行每次请求都会创建（连接池申请连接）和断开（归还连接池）一次连接操作，如果想要在一次请求中指定多个命令，则可以使用pipline实现一次请求指定多个命令，并且默认情况下一次pipline是原子性操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"> </span><br><span class="line">pool = redis.ConnectionPool(host=<span class="string">'10.211.55.4'</span>, port=<span class="number">6379</span>)</span><br><span class="line"> </span><br><span class="line">r = redis.Redis(connection_pool=pool)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># pipe = r.pipeline(transaction=False)</span></span><br><span class="line">pipe = r.pipeline(transaction=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 开始事物</span></span><br><span class="line">pipe.multi()</span><br><span class="line">pipe.set(<span class="string">'name'</span>, <span class="string">'alex'</span>)</span><br><span class="line">pipe.set(<span class="string">'role'</span>, <span class="string">'sb'</span>)</span><br><span class="line"> </span><br><span class="line">pipe.execute()</span><br></pre></td></tr></table></figure>

<p><strong>2.计数器的实现</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">conn = redis.Redis(host=<span class="string">'192.168.1.41'</span>,port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line">conn.set(<span class="string">'count'</span>,<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> conn.pipeline() <span class="keyword">as</span> pipe:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 先监视，自己的值没有被修改过</span></span><br><span class="line">    conn.watch(<span class="string">'count'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 事务开始</span></span><br><span class="line">    pipe.multi()</span><br><span class="line">    old_count = conn.get(<span class="string">'count'</span>)</span><br><span class="line">    count = int(old_count)</span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">0</span>:  <span class="comment"># 有库存</span></span><br><span class="line">        pipe.set(<span class="string">'count'</span>, count - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行，把所有命令一次性推送过去</span></span><br><span class="line">    pipe.execute()</span><br></pre></td></tr></table></figure>

<h3 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a><code>发布订阅</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发布者：服务器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅者：Dashboad和数据处理</span></span><br></pre></td></tr></table></figure>

<p><img src="http://whw.pythonav.cn/py%E6%93%8D%E4%BD%9Credis-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.png" alt="发布订阅"></p>
<h4 id="一个简单的Demo"><a href="#一个简单的Demo" class="headerlink" title="一个简单的Demo"></a><code>一个简单的Demo</code></h4><p><strong>RedisHelper：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisHelper</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__conn = redis.Redis(host=<span class="string">'10.211.55.4'</span>)</span><br><span class="line">        self.chan_sub = <span class="string">'fm104.5'</span></span><br><span class="line">        self.chan_pub = <span class="string">'fm104.5'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">public</span><span class="params">(self, msg)</span>:</span></span><br><span class="line">        self.__conn.publish(self.chan_pub, msg)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subscribe</span><span class="params">(self)</span>:</span></span><br><span class="line">        pub = self.__conn.pubsub()</span><br><span class="line">        pub.subscribe(self.chan_sub)</span><br><span class="line">        pub.parse_response()</span><br><span class="line">        <span class="keyword">return</span> pub</span><br></pre></td></tr></table></figure>

<p><strong>订阅者：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> monitor.RedisHelper <span class="keyword">import</span> RedisHelper</span><br><span class="line"> </span><br><span class="line">obj = RedisHelper()</span><br><span class="line">redis_sub = obj.subscribe()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg= redis_sub.parse_response()</span><br><span class="line">    <span class="keyword">print</span> msg</span><br></pre></td></tr></table></figure>

<p><strong>发布者：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> monitor.RedisHelper <span class="keyword">import</span> RedisHelper</span><br><span class="line"> </span><br><span class="line">obj = RedisHelper()</span><br><span class="line">obj.public(<span class="string">'hello'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="redis哨兵sentinel"><a href="#redis哨兵sentinel" class="headerlink" title="redis哨兵sentinel"></a><code>redis哨兵sentinel</code></h3><p>redis重的sentinel主要用于在redis主从复制中，如果master顾上，则自动将slave替换成master</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> redis.sentinel <span class="keyword">import</span> Sentinel</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 连接哨兵服务器(主机名也可以用域名)</span></span><br><span class="line">sentinel = Sentinel([(<span class="string">'10.211.55.20'</span>, <span class="number">26379</span>),</span><br><span class="line">                     (<span class="string">'10.211.55.20'</span>, <span class="number">26380</span>),</span><br><span class="line">                     ],</span><br><span class="line">                    socket_timeout=<span class="number">0.5</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># # 获取主服务器地址</span></span><br><span class="line"> master = sentinel.discover_master(<span class="string">'mymaster'</span>)</span><br><span class="line"> print(master)</span><br><span class="line"></span><br><span class="line"> <span class="comment"># # 获取从服务器地址</span></span><br><span class="line"> slave = sentinel.discover_slaves(<span class="string">'mymaster'</span>)</span><br><span class="line"> print(slave)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment"># # 获取主服务器进行写入</span></span><br><span class="line"> master = sentinel.master_for(<span class="string">'mymaster'</span>)</span><br><span class="line"> master.set(<span class="string">'foo'</span>, <span class="string">'bar'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment"># # # 获取从服务器进行读取（默认是round-roubin）</span></span><br><span class="line"> slave = sentinel.slave_for(<span class="string">'mymaster'</span>, password=<span class="string">'redis_auth_pass'</span>)</span><br><span class="line"> r_ret = slave.get(<span class="string">'foo'</span>)</span><br><span class="line"> print(r_ret)</span><br></pre></td></tr></table></figure>

<h3 id="转载自下面的文章"><a href="#转载自下面的文章" class="headerlink" title="转载自下面的文章"></a><code>转载自下面的文章</code></h3><p><a href="https://www.cnblogs.com/wupeiqi/articles/5132791.html" target="_blank" rel="noopener"><a href="https://www.cnblogs.com/wupeiqi/articles/5132791.html" target="_blank" rel="noopener">https://www.cnblogs.com/wupeiqi/articles/5132791.html</a></a></p>
<h3 id="更多redis资料"><a href="#更多redis资料" class="headerlink" title="更多redis资料"></a><code>更多redis资料</code></h3><p><a href="http://doc.redisfans.com/" target="_blank" rel="noopener">http://doc.redisfans.com/</a><br><a href="https://github.com/andymccurdy/redis-py/" target="_blank" rel="noopener">https://github.com/andymccurdy/redis-py/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/05/Python操作redis/" data-id="ck0t408ck004kxsccx80ile02" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/缓存/">缓存</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/面试/">面试</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/04/06/常见的缓存数据库及性能对比/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          常见的缓存数据库及性能对比
        
      </div>
    </a>
  
  
    <a href="/2019/04/05/Django中使用redis做缓存的配置方法/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Django中使用redis做缓存的配置方法</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Django/">Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flask/">Flask</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/缓存/">缓存</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面向对象/">面向对象</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django原理/">Django原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django基础/">Django基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask基础/">Flask基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORM/">ORM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pycharm/">Pycharm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logging模块/">logging模块</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/信号signal/">信号signal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/单例模式/">单例模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/异常处理/">异常处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件上传/">文件上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模块与包/">模块与包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缓存/">缓存</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/虚拟环境/">虚拟环境</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面向对象/">面向对象</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Django/" style="font-size: 20px;">Django</a> <a href="/tags/Django原理/" style="font-size: 12.5px;">Django原理</a> <a href="/tags/Django基础/" style="font-size: 20px;">Django基础</a> <a href="/tags/Flask基础/" style="font-size: 17.5px;">Flask基础</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/ORM/" style="font-size: 12.5px;">ORM</a> <a href="/tags/Pycharm/" style="font-size: 12.5px;">Pycharm</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/logging模块/" style="font-size: 10px;">logging模块</a> <a href="/tags/redis/" style="font-size: 17.5px;">redis</a> <a href="/tags/信号signal/" style="font-size: 10px;">信号signal</a> <a href="/tags/单例模式/" style="font-size: 10px;">单例模式</a> <a href="/tags/异常处理/" style="font-size: 12.5px;">异常处理</a> <a href="/tags/文件上传/" style="font-size: 15px;">文件上传</a> <a href="/tags/模块与包/" style="font-size: 17.5px;">模块与包</a> <a href="/tags/缓存/" style="font-size: 17.5px;">缓存</a> <a href="/tags/虚拟环境/" style="font-size: 10px;">虚拟环境</a> <a href="/tags/面向对象/" style="font-size: 12.5px;">面向对象</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/21/Django中的信号signal/">Django中的信号signal</a>
          </li>
        
          <li>
            <a href="/2019/08/30/Pycharm与Python3中的TypeHint/">Pycharm与Python3中的TypeHint</a>
          </li>
        
          <li>
            <a href="/2019/08/10/Flask的版本与返回字典数据的问题/">Flask的版本与返回字典数据的问题</a>
          </li>
        
          <li>
            <a href="/2019/08/09/浅谈Python中字典的打散传参/">浅谈Python中字典的打散传参</a>
          </li>
        
          <li>
            <a href="/2019/08/08/浅析Django的settings配置原理/">浅析Django的settings配置原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>